<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>jQuery Weather App</title>
  <link rel="stylesheet" href="assets/css/hotlinecss.css">
</head>
<body class="sans-serif">
  <div id="container" class="h-100vh flex flex-column justify-center items-center">
    <noscript class="font-bold light-red">Enable Javascript</noscript>
    <div id="loading">Loading...</div>
    <div id="imageContainer"></div>
    <div id="temperatureContainer"></div>
    <div id="cityContainer"></div>
  </div>
  <script src="assets/js/jquery-3.3.1.js"></script>
  <script>
    $(function () {

      var Weather = (function () {

        var $loading = $('#loading');
        var $container = $('#container');
        var $imageContainer = $('#imageContainer');
        var $temperatureContainer = $('#temperatureContainer');
        var $cityContainer = $('#cityContainer');
        var API_KEY = '5f8eef4029d7a333d7a327274d23b964';

        var init = function () {
          startAll();
          console.log('Icons by Erik Flowers');
        }

        var startAll = function () {
          if ('geolocation' in navigator) {
            navigator.geolocation.getCurrentPosition(success, error);
          }
        }

        var removeLoading = function () {
          $loading.remove();
        }

        var success = function (position) {
          getTemperatureData(position);
        }

        var error = function (error) {
          removeLoading();
          $container.empty();
          if (error.code === 1) {
            $('</p>')
              .attr({ class: 'font-bold black-80' })
              .text(error.message)
              .appendTo($container.addClass('bg-gray-2'))
          }
          if (error.code === 2) {
            $('</p>')
              .attr({ class: 'font-bold white text-center' })
              .text(error.message)
              .appendTo($container.addClass('bg-light-red'))
          }
        }
        
        var changeBackground = function (temperature) {
          if (temperature >= 30) {
            $container.addClass('bg-red white');
          }
          if (temperature <= 30 && temperature >= 20) {
            $container.addClass('bg-light-blue white');
          }
          if (temperature < 20) {
            $container.addClass('bg-light-gray')
          }
        }

        var getTemperatureData = function (position) {
          $.ajax({
            url: 'https://api.openweathermap.org/data/2.5/weather?lat=' + position.coords.latitude + '&lon=' + position.coords.longitude + '&units=metric' + '&APPID=' + API_KEY,
            method: 'GET',
            dataType: 'json'
          })
          .done(function (response) {
            $loading.show();
            renderImage(response.weather[0]);
            changeBackground(response.main.temp);
            renderTemperature(response.main.temp);
            renderCity(response.name);
            removeLoading();
          })
          .fail(function (error) {
            console.log(error);
          })
        }

        var renderImage = function (element) {
          $imageContainer
            .append(
              $('<img />')
                .attr({ 
                  class: 'h-6',
                  src: 'assets/icons/' + element.icon + '.svg',
                  alt: element.description + ' [ICON]'
                })
            )
        }

        var renderTemperature = function (temperature) {
          $temperatureContainer
            .append(
              $('<h1>')
                .attr({ class: 'font-1 mt2 mb1' })
                .text(temperature + ' ÂºC')
            )
        }

        var renderCity = function (city) {
          $cityContainer
            .append(
              $('</p>')
                .attr({ class: 'tracked text-uppercase' })
                .text(city)
            )
        }

        return {
          init: init
        };

      })();

      Weather.init();

    })
  </script>
</body>
</html>